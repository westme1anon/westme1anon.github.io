import{o as Te,i as ke}from"./lifecycle.5Ap2lG4L.js";import{e as m,f as O,t as A,a as d,p as Ae,b as Ie,g as t,m as q,h as f,s as I,i as x,r as v,c as U,n as Be}from"./template.u9TWndYC.js";import{s as B}from"./render.CEs9TuJY.js";import{i as h}from"./if.DvYlwJjJ.js";import{e as se,i as oe}from"./each.Dn1gkYdv.js";import{e as M}from"./utils.BZ1KpxG4.js";import{a as Ee}from"./props.B8XIlXrz.js";import{I as H}from"./Icon.DbanfNGG.js";import{I as ae}from"./zh_TW.12WzXWON.js";import{i as ne}from"./translation.RNxcUQCy.js";import{n as Le}from"./navigation-utils.Cc6bKnia.js";import{panelManager as ie}from"./panel-manager.BYknToDe.js";/* empty css                        */import"./functions.WhpeioxD.js";import"./config.DloxKmO1.js";var Se=m('<div class="text-center py-8 text-black/50 dark:text-white/50"><!> <p>暂无文章</p></div>'),ze=m('<div class="post-category svelte-cz3h3s"> </div>'),Pe=m('<button class="post-item svelte-cz3h3s"><div class="post-title svelte-cz3h3s"><!> </div> <!></button>'),Oe=m('<div class="post-content svelte-cz3h3s"></div>'),qe=m('<div class="text-center py-8 text-black/50 dark:text-white/50"><p>当前页面没有目录</p></div>'),Me=m('<span class="badge svelte-cz3h3s"> </span>'),He=m('<span class="dot-square svelte-cz3h3s"></span>'),De=m('<span class="dot-small svelte-cz3h3s"></span>'),je=m('<button><!> <span class="toc-text svelte-cz3h3s"> </span></button>'),Fe=m('<div class="toc-content svelte-cz3h3s"></div>'),Je=m(`<button aria-label="Table of Contents" id="mobile-toc-switch" class="btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90 lg:!hidden theme-switch-btn"><!></button> <div id="mobile-toc-panel" class="float-panel float-panel-closed mobile-toc-panel absolute md:w-[20rem] w-[calc(100vw-2rem)]
		top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-4 svelte-cz3h3s"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-bold text-[var(--primary)]"> </h3> <button aria-label="Close TOC" class="btn-plain rounded-lg h-8 w-8 active:scale-90 theme-switch-btn"><!></button></div> <!></div>`,1);function ot(re,le){Ie(le,!1);let D=q([]),j=q([]),E=q(""),b,L=q(!1),S=!1,W=!1,X=3;const Z=async()=>{await ie.togglePanel("mobile-toc-panel")},$=async e=>{await ie.togglePanel("mobile-toc-panel",e)},ce=()=>{W=window.siteConfig?.toc?.useJapaneseBadge||!1,X=window.siteConfig?.toc?.depth||3;const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),s=[],r=["ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト"];let a=0;e.forEach(l=>{if(l.id){const o=Number.parseInt(l.tagName.charAt(1),10);if(o>X)return;const n=(l.textContent||"").replace(/#+\s*$/,"");let p="";o===1&&(a++,W&&a-1<r.length?p=r[a-1]:p=a.toString()),s.push({id:l.id,text:n,level:o,badge:p})}}),I(D,s)},de=()=>{const e=document.querySelectorAll(".card-base"),s=[];e.forEach(r=>{const a=r.querySelector('a[href*="/posts/"].transition.group'),l=r.querySelector('a[href*="/categories/"].link-lg'),o=a?.querySelector('svg[data-icon="mdi:pin"]');if(a){const n=a.getAttribute("href"),p=a.textContent?.replace(/\s+/g," ").trim()||"",i=l?.textContent?.trim()||"",u=!!o;n&&p&&s.push({title:p,url:n,category:i,pinned:u})}}),I(j,s)},ve=()=>{I(L,window.location.pathname==="/"||window.location.pathname==="")},pe=e=>{const s=document.getElementById(e);if(s){$(!1);const a=s.offsetTop-80;window.scrollTo({top:a,behavior:"smooth"})}},ue=e=>{$(!1),Le(e)},F=()=>{const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),s=window.scrollY,r=100;let a="";e.forEach(l=>{if(l.id){const o=l.offsetTop-r;s>=o&&(a=l.id)}}),I(E,a)},fe=()=>{const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6");b&&b.disconnect(),b=new IntersectionObserver(s=>{s.forEach(r=>{r.isIntersecting&&I(E,r.target.id)})},{rootMargin:"-80px 0px -80% 0px",threshold:0}),e.forEach(s=>{s.id&&b.observe(s)})};let y=!1;const J=()=>{typeof window<"u"&&window.swup&&!y?(window.swup.hooks.on("page:view",()=>{setTimeout(()=>{C()},200)}),y=!0,console.log("MobileTOC Swup listener registered")):y||(window.addEventListener("popstate",()=>{setTimeout(C,200)}),y=!0,console.log("MobileTOC fallback listener registered"))},me=()=>{if(typeof window<"u")if(S=!!window.swup,S)J();else{const e=()=>{window.swup&&(S=!0,document.removeEventListener("swup:enable",e),J())};document.addEventListener("swup:enable",e),setTimeout(()=>{window.swup&&(S=!0,document.removeEventListener("swup:enable",e),J())},1e3)}},C=()=>{ve(),me(),t(L)?de():(ce(),fe(),F())};Te(()=>(setTimeout(C,100),window.addEventListener("scroll",F),()=>{b&&b.disconnect(),window.removeEventListener("scroll",F),typeof window<"u"&&window.swup&&window.swup.hooks.off("page:view"),window.removeEventListener("popstate",C),y=!1})),typeof window<"u"&&(window.mobileTOCInit=C),ke();var ee=Je(),z=O(ee),we=f(z);H(we,{icon:"material-symbols:format-list-bulleted",class:"text-[1.25rem]"}),v(z);var te=x(z,2),N=f(te),R=f(N),he=f(R,!0);v(R);var K=x(R,2),be=f(K);H(be,{icon:"material-symbols:close",class:"text-[1rem]"}),v(K),v(N);var ge=x(N,2);{var _e=e=>{var s=U(),r=O(s);{var a=o=>{var n=Se(),p=f(n);H(p,{icon:"material-symbols:article-outline",class:"text-2xl mb-2"}),Be(2),v(n),d(o,n)},l=o=>{var n=Oe();se(n,5,()=>t(j),oe,(p,i)=>{var u=Pe(),g=f(u),T=f(g);{var V=c=>{H(c,{icon:"mdi:pin",class:"pinned-icon"})};h(T,c=>{t(i).pinned&&c(V)})}var Y=x(T);v(g);var P=x(g,2);{var G=c=>{var w=ze(),k=f(w,!0);v(w),A(()=>B(k,t(i).category)),d(c,w)};h(P,c=>{t(i).category&&c(G)})}v(u),A(()=>B(Y,` ${t(i).title??""}`)),M("click",u,()=>ue(t(i).url)),d(p,u)}),v(n),d(o,n)};h(r,o=>{t(j).length===0?o(a):o(l,!1)})}d(e,s)},xe=e=>{var s=U(),r=O(s);{var a=o=>{var n=qe();d(o,n)},l=o=>{var n=Fe();se(n,5,()=>t(D),oe,(p,i)=>{var u=je();let g;var T=f(u);{var V=c=>{var w=Me(),k=f(w,!0);v(w),A(()=>B(k,t(i).badge)),d(c,w)},Y=c=>{var w=U(),k=O(w);{var ye=_=>{var Q=He();d(_,Q)},Ce=_=>{var Q=De();d(_,Q)};h(k,_=>{t(i).level===2?_(ye):_(Ce,!1)},!0)}d(c,w)};h(T,c=>{t(i).level===1?c(V):c(Y,!1)})}var P=x(T,2),G=f(P,!0);v(P),v(u),A(()=>{g=Ee(u,1,`toc-item level-${t(i).level??""} ${t(E)===t(i).id?"active":""}`,"svelte-cz3h3s",g,{active:t(E)===t(i).id}),B(G,t(i).text)}),M("click",u,()=>pe(t(i).id)),d(p,u)}),v(n),d(o,n)};h(r,o=>{t(D).length===0?o(a):o(l,!1)})}d(e,s)};h(ge,e=>{t(L)?e(_e):e(xe,!1)})}v(te),A(e=>B(he,e),[()=>t(L)?ne(ae.postList):ne(ae.tableOfContents)]),M("click",z,Z),M("click",K,Z),d(re,ee),Ae()}export{ot as default};
